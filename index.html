
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Listening Quiz</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background-color: #f7f7f7; }
    .container { background: white; padding: 20px; border-radius: 8px; max-width: 800px; margin: auto; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .btn { padding: 14px 24px; border: none; border-radius: 6px; cursor: pointer; margin: 6px 6px 6px 0; font-size: 18px; }
    .play-btn { background-color: #4CAF50; color: white; }
    .check-btn { background-color: #2196F3; color: white; }
    .next-btn { background-color: #FF9800; color: white; }
    .restart-btn { background-color: #9C27B0; color: white; }
    .level-btn { background-color: #607D8B; color: white; }
    .level-btn.active { background-color: #1A237E; }
    .result-box { background: #eef3f7; padding: 15px; margin-top: 10px; border-radius: 6px; min-height: 50px; font-size: 18px; }
    .progress-bar { height: 12px; background-color: #ddd; border-radius: 5px; overflow: hidden; margin-top: 20px; }
    .progress { height: 100%; background-color: #f4b400; width: 0%; transition: width 0.3s; }
    textarea { width: 100%; height: 80px; margin-top: 10px; font-size: 18px; }
    .highlight-correct { color: blue; font-weight: bold; }
    .highlight-wrong { color: red; text-decoration: line-through; font-weight: bold; }
    .score-report { margin-top: 10px; font-size: 18px; }
    .correct-count { color: green; font-weight: bold; }
    .wrong-count { color: red; font-weight: bold; }
    .primary-buttons, .secondary-buttons { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }
    .secondary-buttons { justify-content: flex-start; margin-top: 20px; }
    @media (max-width: 600px) {
      .btn { width: 100%; font-size: 20px; }
      textarea { font-size: 20px; }
    }
  </style>
</head>
<body>
<div class="container">
  <h2>Listening Practice</h2>
  <div>
    <button class="btn level-btn" id="btn-a2" onclick="loadLevel('phrases_a2_translated.json', 'A2', this)">A2</button>
    <button class="btn level-btn" id="btn-b1" onclick="loadLevel('phrases_b1_translated.json', 'B1', this)">B1</button>
    <button class="btn level-btn" id="btn-b2" onclick="loadLevel('phrases_b2_translated.json', 'B2', this)">B2</button>
  </div>
  <div>
  <a href="c1.html" class="btn level-btn" style="background-color:#3f51b5">‚ñ∂ Go to C1 Level</a>
</div>

  <div class="primary-buttons">
    <button class="btn play-btn" onclick="playAudio()">‚ñ∂ PLAY</button>
    <button class="btn check-btn" onclick="checkAnswer()">‚úî CHECK</button>
  </div>
  <textarea id="userInput" placeholder="Type what you heard..."></textarea>
  <div class="result-box" id="resultBox"></div>
  <div class="secondary-buttons">
    <button class="btn next-btn" onclick="nextPhrase()">‚û° NEXT</button>
    <button class="btn restart-btn" onclick="startOver()">üîÑ START OVER</button>
  </div>
  <div class="progress-bar"><div class="progress" id="progressBar"></div></div>
  <div class="score-report">‚úÖ Correct: <span id="correctCount" class="correct-count">0</span> | ‚ùå Incorrect: <span id="wrongCount" class="wrong-count">0</span></div>
</div>

<script>
  let phrases = [];
  let phraseIndex = 0;
  let currentLevelFolder = "";
  let correctCount = 0;
  let wrongCount = 0;

  function loadLevel(jsonFile, folder, btnElement) {
    currentLevelFolder = folder;
    fetch(jsonFile)
      .then(response => response.json())
      .then(data => {
        phrases = data;
        startOver();
        highlightActiveButton(btnElement);
      });
  }

  function highlightActiveButton(activeBtn) {
    document.querySelectorAll('.level-btn').forEach(btn => btn.classList.remove('active'));
    if (activeBtn) activeBtn.classList.add('active');
  }

  function getCurrentEnglishPhrase() {
    return phrases[phraseIndex].en || "";
  }

  function getCurrentTranslation() {
    return phrases[phraseIndex].ru || "";
  }

  function playAudio() {
    if (!phrases.length) return;
    const fileNum = String(phraseIndex + 1).padStart(2, '0');
    const audioFile = `sounds/${currentLevelFolder}/${fileNum}_Chapter 1.mp3`;
    const audio = new Audio(audioFile);
    audio.play();
  }

  function checkAnswer() {
    const phrase = getCurrentEnglishPhrase();
    const user = document.getElementById('userInput').value.trim();
    const resultBox = document.getElementById('resultBox');
    const correctWords = phrase.split(' ');
    const userWords = user.split(' ');
    let resultHTML = '';
    let correct = true;

    for (let i = 0; i < correctWords.length; i++) {
      if (userWords[i] === correctWords[i]) {
        resultHTML += `<span class="highlight-correct">${correctWords[i]}</span> `;
      } else {
        correct = false;
        if (userWords[i]) {
          resultHTML += `<span class="highlight-wrong">${userWords[i]}</span> `;
        }
        resultHTML += `<span class="highlight-correct">${correctWords[i]}</span> `;
      }
    }

    const translation = getCurrentTranslation();
resultHTML += `<br><strong>–ü–µ—Ä–µ–≤–æ–¥:</strong> ${translation}`;
resultBox.innerHTML = resultHTML.trim();


    if (correct) correctCount++;
    else wrongCount++;
    updateProgress();
    updateScore();

    setTimeout(nextPhrase, 8500);
  }

  function nextPhrase() {
    phraseIndex = (phraseIndex + 1) % phrases.length;
    document.getElementById('userInput').value = '';
    document.getElementById('resultBox').innerHTML = '';
  }

  function updateProgress() {
    const progress = document.getElementById('progressBar');
    let progressPercent = Math.min(100, (correctCount / phrases.length) * 100);
    progress.style.width = progressPercent + '%';
  }

  function updateScore() {
    document.getElementById('correctCount').textContent = correctCount;
    document.getElementById('wrongCount').textContent = wrongCount;
  }

  function startOver() {
    phraseIndex = 0;
    correctCount = 0;
    wrongCount = 0;
    document.getElementById('userInput').value = '';
    document.getElementById('resultBox').innerHTML = '';
    updateProgress();
    updateScore();
  }

  window.onload = function() {
    loadLevel("phrases_b2_translated.json", "B2", document.getElementById('btn-b2'));
  };
</script>
</body>
</html>
